name: CI

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Lint nginx configuration
        run: make lint

      - name: Trigger release-tools deploy
        run: |
          gh api \
            --method POST \
            repos/s-hikonyan-sys/art-gallery-release-tools/actions/workflows/deploy_nginx.yml/dispatches \
            -f ref=main \
            -F inputs[nginx_ref]="${{ github.sha }}"
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN_FOR_ART_GALLERY_RELEASE_TOOLS }}
